# ğŸš€ æ•°æ®åº“å‡çº§æŒ‡å—

## ğŸ“‹ å‡çº§æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†ä»æ—§ç‰ˆæœ¬å‡çº§åˆ° **v1.1.0** çš„è¯¦ç»†æ­¥éª¤ã€‚

**å‡çº§å†…å®¹ï¼š**
- âœˆï¸ æ–°å¢æ—…è¡Œè®¡åˆ’æ¨¡å—ï¼ˆtravel_plans, travel_footprintsï¼‰
- ğŸ“– æ–°å¢å¤è¯—èƒŒè¯µæ¨¡å—ï¼ˆpoemsï¼‰
- âœ… æ–°å¢æ—¥å¸¸ä»»åŠ¡æ¨¡å—ï¼ˆdaily_tasks, task_completionsï¼‰
- ğŸ”§ æ–°å¢æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†ï¼ˆdb_versionï¼‰

## âš ï¸ å‡çº§å‰å‡†å¤‡

### 1. ç³»ç»Ÿè¦æ±‚
- Docker å’Œ Docker Compose å·²å®‰è£…
- åº”ç”¨æ­£åœ¨æ­£å¸¸è¿è¡Œ
- æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆå»ºè®®è‡³å°‘ 500MBï¼‰

### 2. æ£€æŸ¥å½“å‰çŠ¶æ€
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps

# æ£€æŸ¥æ—¥å¿—
docker compose logs --tail=50
```

## ğŸ¯ å‡çº§æ–¹å¼

æä¾›ä¸¤ç§å‡çº§æ–¹å¼ï¼Œæ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©ï¼š

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨å‡çº§ï¼ˆæ¨èï¼‰â­

**ä¼˜ç‚¹ï¼š** è‡ªåŠ¨åŒ–ã€å®‰å…¨ã€å¸¦å¤‡ä»½  
**é€‚åˆï¼š** å¤§å¤šæ•°ç”¨æˆ·

#### æ­¥éª¤ï¼š

1. **è¿›å…¥é¡¹ç›®ç›®å½•**
```bash
cd /opt/eleven_study
```

2. **è¿è¡Œå‡çº§è„šæœ¬**
```bash
./upgrade.sh
```

3. **ç¡®è®¤å‡çº§**
```
ç¡®è®¤ç»§ç»­ï¼Ÿ(y/N) y
```

4. **ç­‰å¾…å®Œæˆ**
è„šæœ¬å°†è‡ªåŠ¨æ‰§è¡Œï¼š
- âœ… å¤‡ä»½æ•°æ®åº“
- âœ… æ‰§è¡Œå‡çº§è„šæœ¬
- âœ… é‡å¯æœåŠ¡
- âœ… éªŒè¯ç»“æœ

#### å‡çº§è„šæœ¬åŠŸèƒ½ï¼š
- ğŸ”’ è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“ï¼ˆæ–‡ä»¶åï¼šbackup_YYYYMMDD_HHMMSS.sqlï¼‰
- ğŸ”„ æ‰§è¡Œå¢é‡æ›´æ–°
- ğŸš€ é‡å¯åç«¯æœåŠ¡
- âœ… éªŒè¯å‡çº§ç»“æœ
- âŒ é”™è¯¯æ—¶è‡ªåŠ¨å›æ»šæç¤º

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å‡çº§

**ä¼˜ç‚¹ï¼š** æ›´å¤šæ§åˆ¶ã€å¯åˆ†æ­¥æ‰§è¡Œ  
**é€‚åˆï¼š** é«˜çº§ç”¨æˆ·æˆ–éœ€è¦è‡ªå®šä¹‰çš„åœºæ™¯

#### æ­¥éª¤ï¼š

**1. å¤‡ä»½æ•°æ®åº“ï¼ˆå¿…é¡»ï¼ï¼‰**
```bash
cd /opt/eleven_study

# åˆ›å»ºå¤‡ä»½
docker compose exec mysql mysqldump -uroot -ppassword literacy_db > backup_$(date +%Y%m%d).sql

# éªŒè¯å¤‡ä»½
ls -lh backup_*.sql
```

**2. æ‰§è¡Œå‡çº§è„šæœ¬**
```bash
# æ–¹æ³•1ï¼šé€šè¿‡ Docker å®¹å™¨æ‰§è¡Œ
docker compose exec -T mysql mysql -uroot -ppassword literacy_db < upgrade_v1.1.0.sql

# æ–¹æ³•2ï¼šå¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨å†…æ‰§è¡Œ
docker cp upgrade_v1.1.0.sql eleven_study-mysql-1:/tmp/
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "source /tmp/upgrade_v1.1.0.sql"
```

**3. é‡å¯åç«¯æœåŠ¡**
```bash
docker compose restart backend

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend
```

**4. éªŒè¯å‡çº§**
```bash
# æ£€æŸ¥æ–°è¡¨æ˜¯å¦åˆ›å»º
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "SHOW TABLES;"

# æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "SELECT * FROM db_version;"

# æµ‹è¯•API
curl http://localhost:5000/api/health
```

---

## ğŸ“Š å‡çº§è„šæœ¬ç‰¹æ€§

### 1. ç‰ˆæœ¬ç®¡ç†
- è‡ªåŠ¨åˆ›å»º `db_version` è¡¨è·Ÿè¸ªç‰ˆæœ¬
- é˜²æ­¢é‡å¤æ‰§è¡ŒåŒä¸€ç‰ˆæœ¬æ›´æ–°
- è®°å½•æ¯æ¬¡æ›´æ–°çš„æ—¶é—´å’Œè¯´æ˜

### 2. å®‰å…¨æ€§
- ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS`ï¼Œä¸ä¼šè¦†ç›–å·²æœ‰æ•°æ®
- å¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œ
- è‡ªåŠ¨è·³è¿‡å·²åº”ç”¨çš„ç‰ˆæœ¬

### 3. æ•°æ®å®Œæ•´æ€§
- å¤–é”®çº¦æŸç¡®ä¿æ•°æ®å…³è”æ­£ç¡®
- ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- é»˜è®¤å€¼å’Œæ³¨é‡Šå®Œå–„

---

## ğŸ” éªŒè¯å‡çº§æˆåŠŸ

### 1. æ£€æŸ¥æ•°æ®åº“è¡¨
```bash
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "
SELECT 
    TABLE_NAME AS 'è¡¨å', 
    TABLE_COMMENT AS 'è¯´æ˜',
    TABLE_ROWS AS 'è®°å½•æ•°'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'literacy_db' 
AND TABLE_NAME IN ('travel_plans', 'travel_footprints', 'poems', 'daily_tasks', 'task_completions', 'db_version')
ORDER BY TABLE_NAME;
"
```

é¢„æœŸè¾“å‡ºï¼š
```
+-----------------------+------------------+-----------+
| è¡¨å                  | è¯´æ˜             | è®°å½•æ•°    |
+-----------------------+------------------+-----------+
| daily_tasks           | æ—¥å¸¸ä»»åŠ¡è¡¨       | 0         |
| db_version            | æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†è¡¨ | 1         |
| poems                 | å¤è¯—è¡¨           | 0         |
| task_completions      | ä»»åŠ¡å®Œæˆè®°å½•è¡¨   | 0         |
| travel_footprints     | æ—…è¡Œè¶³è¿¹è¡¨       | 0         |
| travel_plans          | æ—…è¡Œè®¡åˆ’è¡¨       | 0         |
+-----------------------+------------------+-----------+
```

### 2. æ£€æŸ¥ç‰ˆæœ¬å·
```bash
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "
SELECT version, description, applied_at FROM db_version ORDER BY applied_at DESC;
"
```

é¢„æœŸè¾“å‡ºï¼š
```
+---------+------------------------------------------+---------------------+
| version | description                              | applied_at          |
+---------+------------------------------------------+---------------------+
| v1.1.0  | æ–°å¢æ—…è¡Œè®¡åˆ’ã€å¤è¯—èƒŒè¯µã€æ—¥å¸¸ä»»åŠ¡åŠŸèƒ½æ¨¡å— | 2025-11-05 10:30:00 |
+---------+------------------------------------------+---------------------+
```

### 3. æµ‹è¯•å‰ç«¯åŠŸèƒ½
è®¿é—®åº”ç”¨ï¼š`http://your-server-ip`

æ£€æŸ¥æ–°èœå•ï¼š
- ğŸ“– å¤è¯—è¯ â†’ å¤è¯—èƒŒè¯µ
- âœˆï¸ ç”Ÿæ´»è®°å½• â†’ æ—…è¡Œè®¡åˆ’
- âœ… ç”Ÿæ´»è®°å½• â†’ æ—¥å¸¸ä»»åŠ¡

### 4. æµ‹è¯•APIæ¥å£
```bash
# æµ‹è¯•æ—…è¡Œè®¡åˆ’API
curl http://localhost:5000/api/travel-plans

# æµ‹è¯•å¤è¯—API
curl http://localhost:5000/api/poems

# æµ‹è¯•æ—¥å¸¸ä»»åŠ¡API
curl http://localhost:5000/api/daily-tasks
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å‡çº§è„šæœ¬æç¤º"ç‰ˆæœ¬å·²å­˜åœ¨"
**åŸå› ï¼š** è¯¥ç‰ˆæœ¬å·²ç»åº”ç”¨è¿‡  
**è§£å†³ï¼š** æ— éœ€å¤„ç†ï¼Œè¯´æ˜æ•°æ®åº“å·²æ˜¯æœ€æ–°ç‰ˆæœ¬

### Q2: å‡çº§å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**è§£å†³æ­¥éª¤ï¼š**
```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker compose logs mysql

# 2. æ¢å¤å¤‡ä»½
docker compose exec -T mysql mysql -uroot -ppassword literacy_db < backup_YYYYMMDD.sql

# 3. é‡æ–°å°è¯•
./upgrade.sh
```

### Q3: æœåŠ¡å¯åŠ¨å¤±è´¥
**è§£å†³æ­¥éª¤ï¼š**
```bash
# 1. æŸ¥çœ‹å…·ä½“é”™è¯¯
docker compose logs backend

# 2. é‡å¯æ‰€æœ‰æœåŠ¡
docker compose restart

# 3. å¦‚æœè¿˜ä¸è¡Œï¼Œé‡æ–°æ„å»º
docker compose down
docker compose up -d
```

### Q4: æ–°åŠŸèƒ½èœå•çœ‹ä¸åˆ°
**åŸå› ï¼š** å‰ç«¯ç¼“å­˜é—®é¢˜  
**è§£å†³ï¼š**
- å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+F5 æˆ– Cmd+Shift+Rï¼‰
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- é‡æ–°æ„å»ºå‰ç«¯ï¼š`docker compose up -d --build frontend`

### Q5: APIè¿”å›404é”™è¯¯
**åŸå› ï¼š** åç«¯æœåŠ¡æœªæ›´æ–°  
**è§£å†³ï¼š**
```bash
# é‡å¯åç«¯
docker compose restart backend

# æˆ–é‡æ–°æ„å»º
docker compose up -d --build backend
```

---

## ğŸ”„ å›æ»šå‡çº§

å¦‚æœå‡çº§åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¤‡ä»½æ¢å¤
```bash
# 1. åœæ­¢æœåŠ¡
docker compose stop backend

# 2. æ¢å¤æ•°æ®åº“
docker compose exec -T mysql mysql -uroot -ppassword literacy_db < backup_YYYYMMDD.sql

# 3. é‡å¯æœåŠ¡
docker compose start backend
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ é™¤æ–°è¡¨
```bash
docker compose exec mysql mysql -uroot -ppassword literacy_db -e "
DROP TABLE IF EXISTS task_completions;
DROP TABLE IF EXISTS daily_tasks;
DROP TABLE IF EXISTS poems;
DROP TABLE IF EXISTS travel_footprints;
DROP TABLE IF EXISTS travel_plans;
DELETE FROM db_version WHERE version = 'v1.1.0';
"
```

---

## ğŸ“ å‡çº§æ—¥å¿—æ¨¡æ¿

å»ºè®®è®°å½•æ¯æ¬¡å‡çº§çš„æƒ…å†µï¼š

```
å‡çº§æ—¥æœŸï¼š2025-11-05
å‡çº§ç‰ˆæœ¬ï¼šv1.1.0
æ‰§è¡Œäººå‘˜ï¼š[æ‚¨çš„åå­—]
å¤‡ä»½æ–‡ä»¶ï¼šbackup_20251105.sql
å‡çº§ç»“æœï¼šâœ… æˆåŠŸ / âŒ å¤±è´¥
é—®é¢˜è®°å½•ï¼šæ—  / [æè¿°é—®é¢˜]
å›æ»šæƒ…å†µï¼šæ—  / [æè¿°å›æ»š]
éªŒè¯ç»“æœï¼šâœ… é€šè¿‡
å¤‡æ³¨ï¼š[å…¶ä»–è¯´æ˜]
```

---

## ğŸ‰ å‡çº§å®Œæˆå

### 1. æ¸…ç†æ—§å¤‡ä»½
```bash
# ä¿ç•™æœ€è¿‘3ä¸ªå¤‡ä»½ï¼Œåˆ é™¤æ—§å¤‡ä»½
ls -t backup_*.sql | tail -n +4 | xargs rm -f
```

### 2. æ›´æ–°æ–‡æ¡£
- æ›´æ–°å›¢é˜Ÿæ–‡æ¡£
- é€šçŸ¥ç›¸å…³äººå‘˜
- è®°å½•å‡çº§æ—¥å¿—

### 3. ç›‘æ§è¿è¡Œ
```bash
# æŒç»­ç›‘æ§æ—¥å¿—
docker compose logs -f

# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker compose logs`
2. æ£€æŸ¥æ–‡æ¡£ï¼š`æ›´æ–°è¯´æ˜.md`
3. æŸ¥çœ‹å¤‡ä»½ï¼š`ls -lh backup_*.sql`

---

**å‡çº§å·¥å…·ç‰ˆæœ¬ï¼š** v1.1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-05  
**æ–‡æ¡£çŠ¶æ€ï¼š** âœ… å·²éªŒè¯

