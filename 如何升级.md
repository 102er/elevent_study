# 📦 如何升级到最新版本

## 🎯 当前版本

- **v1.1.0**: 旅行计划 + 古诗词 + 日常任务
- **v1.2.0**: 旅行足迹地图 + 星星兑换 + 我的奖励（最新）

---

## ⚡ 快速升级（推荐）

### 如果你还在初始版本

直接升级到 v1.2.0（包含 v1.1.0 所有功能）：

```bash
cd /Users/102er/Desktop/WORK/github.com/eleven_study
./upgrade_to_v1.2.0.sh
```

### 如果你已经在 v1.1.0

只需执行 v1.2.0 升级：

```bash
cd /Users/102er/Desktop/WORK/github.com/eleven_study
./upgrade_to_v1.2.0.sh
```

---

## 📋 升级流程

升级脚本会自动完成以下步骤：

1. ✅ **检查环境** - 验证 Docker 服务运行状态
2. 💾 **备份数据** - 自动备份当前数据库
3. 🔧 **执行升级** - 增量更新数据库结构
4. 🔄 **重启服务** - 重启后端应用
5. ✔️  **验证升级** - 检查新功能是否正常

---

## 🎁 v1.2.0 新功能

### 1. 旅行足迹地图 🗺️
- 三个小人代表一家三口（爸爸👨、妈妈👩、宝宝👶）
- 可视化展示所有旅行历史
- 查看每次旅行的花费和获得的星星

**访问路径**: 生活记录 → 旅行足迹

### 2. 我的奖励（独立模块）🏆
- 查看学习成就和徽章
- 查看星星兑换历史
- 实时显示当前星星数量

**访问路径**: 我的奖励 → 成就徽章

### 3. 星星兑换系统 🎁
- 用星星兑换奖励商品
- 自定义添加新商品
- 默认商品：游乐园、玩具、大餐、电影、零食、周末旅行

**访问路径**: 我的奖励 → 星星兑换

---

## 🛡️ 安全保障

### 自动备份
每次升级前会自动创建数据库备份：
```
backup_v1.2.0_20251106_143022.sql
```

### 如何恢复备份
如果升级出现问题，可以恢复备份：

```bash
# 找到备份文件
ls backup_*.sql

# 恢复数据库（替换为实际的备份文件名）
docker compose exec -T mysql mysql -uroot -pliteracy2024 literacy_db < backup_v1.2.0_YYYYMMDD_HHMMSS.sql

# 重启服务
docker compose restart backend
```

---

## 🔍 验证升级成功

### 方法 1：查看数据库版本
```bash
docker compose exec mysql mysql -uroot -pliteracy2024 literacy_db -e "SELECT * FROM db_version;"
```

应该看到 `v1.2.0` 版本记录。

### 方法 2：测试新 API
```bash
# 测试奖励商品 API
curl http://localhost:5000/api/reward-items

# 测试星星兑换 API
curl http://localhost:5000/api/star-redemptions
```

### 方法 3：访问应用
打开浏览器访问应用，查看是否有以下新菜单：
- ✅ 生活记录 → 旅行足迹
- ✅ 我的奖励 → 成就徽章
- ✅ 我的奖励 → 星星兑换

---

## ⏱️ 升级耗时

| 步骤 | 预计时间 |
|------|---------|
| 备份数据库 | 5-10秒 |
| 执行升级脚本 | 10-20秒 |
| 重启服务 | 5-10秒 |
| **总计** | **≈ 1分钟** |

**停机时间**: 仅在重启服务时约 10 秒

---

## 🆘 常见问题

### Q1: 升级脚本没有执行权限？
```bash
chmod +x upgrade_to_v1.2.0.sh
```

### Q2: Docker 服务未运行？
```bash
docker compose up -d
```

### Q3: 找不到升级脚本？
确保你在项目根目录：
```bash
cd /Users/102er/Desktop/WORK/github.com/eleven_study
ls upgrade_to_v1.2.0.sh
```

### Q4: 数据库连接失败？
检查数据库密码是否正确（literacy2024）

### Q5: 升级后页面报错？
清除浏览器缓存，强制刷新（Ctrl + F5 或 Cmd + Shift + R）

---

## 📚 更多文档

- 📘 [快速升级.md](./快速升级.md) - 快速参考命令
- 📗 [升级指南.md](./升级指南.md) - 详细升级文档
- 📕 [v1.2.0_更新说明.md](./v1.2.0_更新说明.md) - 版本更新详情
- 📙 [升级文件说明.md](./升级文件说明.md) - 文件用途说明

---

## ✨ 开始升级

准备好了吗？执行以下命令开始升级：

```bash
cd /Users/102er/Desktop/WORK/github.com/eleven_study
./upgrade_to_v1.2.0.sh
```

按 `y` 确认，等待完成即可！🎉

---

**升级前提示**：
- ⚠️  确保 Docker 服务正常运行
- ⚠️  建议在低峰时段升级
- ⚠️  升级前可先手动备份数据库
- ✅ 升级脚本会自动备份，无需担心

**需要帮助？** 查看日志：
```bash
docker compose logs -f backend
```

