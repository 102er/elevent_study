# ğŸš€ å¿«é€Ÿå‡çº§æŒ‡å— - v2.0

## ğŸ“‹ å‡çº§å†…å®¹

æœ¬æ¬¡å‡çº§åŒ…å«ä¸¤ä¸ªä¸»è¦æ”¹åŠ¨ï¼š

### 1. **åŠŸèƒ½å‡çº§** 
- âœ… æ–°å¢é˜…è¯»è®°å½•ç®¡ç†æ¨¡å—
- âœ… æ”¯æŒæ·»åŠ å’Œç®¡ç†ä¹¦ç±
- âœ… è¿½è¸ªé˜…è¯»è¿›åº¦å’Œå®ŒæˆçŠ¶æ€
- âœ… é˜…è¯»ç»Ÿè®¡åŠŸèƒ½

### 2. **æ•°æ®ç®¡ç†ä¼˜åŒ–**
- âœ… MySQLæ•°æ®ä»Dockerå·è¿ç§»åˆ°æœ¬åœ°ç›®å½•
- âœ… æ•°æ®ä½ç½®ï¼š`./data/mysql/`
- âœ… æ›´æ–¹ä¾¿å¤‡ä»½å’Œç®¡ç†

---

## âš¡ ä¸€é”®å‡çº§ï¼ˆæ¨èï¼‰

å¦‚æœä½ **å·²ç»éƒ¨ç½²äº†æ—§ç‰ˆæœ¬**ï¼Œä½¿ç”¨ä¸€é”®å‡çº§è„šæœ¬ï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/eleven_study

# 2. å¦‚æœéœ€è¦ï¼Œè®¾ç½®MySQLå¯†ç ï¼ˆå¦‚æœä½ æ”¹è¿‡é»˜è®¤å¯†ç ï¼‰
export MYSQL_ROOT_PASSWORD=ä½ çš„å¯†ç 

# 3. è¿è¡Œå‡çº§è„šæœ¬
./upgrade-and-mount.sh
```

### è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… å¤‡ä»½å½“å‰æ•°æ®
2. âœ… åœæ­¢æœåŠ¡
3. âœ… è¿ç§»æ•°æ®åˆ° `./data/mysql`
4. âœ… æ›´æ–°æ•°æ®åº“ç»“æ„ï¼ˆæ·»åŠ ä¹¦ç±å’Œé˜…è¯»è®°å½•è¡¨ï¼‰
5. âœ… é‡æ–°æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
6. âœ… éªŒè¯å‡çº§ç»“æœ

---

## ğŸ“ æ‰‹åŠ¨å‡çº§æ­¥éª¤

å¦‚æœä½ æƒ³æ‰‹åŠ¨æ§åˆ¶æ¯ä¸€æ­¥ï¼š

### æ­¥éª¤1ï¼šå¤‡ä»½æ•°æ®

```bash
cd /opt/eleven_study

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups

# å¤‡ä»½æ•°æ®åº“
docker compose exec mysql mysqldump -uroot -på¯†ç  --all-databases > backups/backup_$(date +%Y%m%d).sql
```

### æ­¥éª¤2ï¼šåœæ­¢æœåŠ¡

```bash
docker compose down
```

### æ­¥éª¤3ï¼šè¿ç§»æ•°æ®åˆ°æœ¬åœ°ç›®å½•

```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p ./data/mysql

# ä»Dockerå·å¤åˆ¶æ•°æ®
docker run --rm \
    -v eleven_study_mysql_data:/source:ro \
    -v $(pwd)/data/mysql:/target \
    alpine \
    sh -c "cp -av /source/. /target/"
```

### æ­¥éª¤4ï¼šæ›´æ–°ä»£ç 

```bash
# å¦‚æœæ˜¯ä»gitæ‹‰å–
git pull

# æˆ–è€…é‡æ–°ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
```

### æ­¥éª¤5ï¼šæ›´æ–°æ•°æ®åº“

```bash
# å¯åŠ¨MySQL
docker compose up -d mysql

# ç­‰å¾…å¯åŠ¨
sleep 20

# æ‰§è¡Œè¿ç§»è„šæœ¬
docker compose exec -T mysql mysql -uroot -på¯†ç  literacy_db < migrate-add-reading.sql
```

### æ­¥éª¤6ï¼šé‡æ–°æ„å»ºæœåŠ¡

```bash
# å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆå¦‚æœæ²¡æœ‰npmï¼Œç”¨Dockerï¼‰
docker run --rm \
    -v $(pwd)/frontend:/app \
    -w /app \
    node:18-alpine \
    sh -c "npm install --legacy-peer-deps"

# é‡æ–°æ„å»º
docker compose build --no-cache

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d
```

### æ­¥éª¤7ï¼šéªŒè¯

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# éªŒè¯æ•°æ®
docker compose exec mysql mysql -uroot -på¯†ç  -e "USE literacy_db; SHOW TABLES;"
```

---

## ğŸ†• é¦–æ¬¡éƒ¨ç½²ï¼ˆå…¨æ–°å®‰è£…ï¼‰

å¦‚æœæ˜¯**é¦–æ¬¡éƒ¨ç½²**ï¼Œä½¿ç”¨åˆå§‹åŒ–è„šæœ¬ï¼š

```bash
# 1. ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°æœåŠ¡å™¨
cd /opt/eleven_study

# 2. è¿è¡Œåˆå§‹åŒ–è„šæœ¬
./init-setup.sh

# æˆ–è€…ï¼ˆCentOS 7ä¸“ç”¨ï¼‰
./deploy-centos7.sh
```

---

## âœ… éªŒè¯å‡çº§

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
docker compose ps
```

åº”è¯¥çœ‹åˆ°ä¸‰ä¸ªæœåŠ¡éƒ½æ˜¯ `Up` çŠ¶æ€ï¼š
- literacy-mysql
- literacy-backend
- literacy-frontend

### 2. è®¿é—®ç½‘ç«™

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://æœåŠ¡å™¨IP`

åº”è¯¥èƒ½çœ‹åˆ°æ–°å¢çš„"é˜…è¯»è®°å½•"èœå•

### 3. éªŒè¯æ•°æ®

```bash
# æŸ¥çœ‹æ•°æ®ç›®å½•
ls -lh ./data/mysql

# éªŒè¯æ•°æ®åº“è¡¨
docker compose exec mysql mysql -uroot -på¯†ç  -e "
USE literacy_db; 
SELECT COUNT(*) as word_count FROM words;
SELECT COUNT(*) as book_count FROM books;
"
```

---

## ğŸ”„ ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | v1.0 | v2.0 |
|------|------|------|
| æ±‰å­—å­¦ä¹  | âœ… | âœ… |
| æ˜Ÿæ˜Ÿå¥–åŠ± | âœ… | âœ… |
| æ¯å‘¨ç»Ÿè®¡ | âœ… | âœ… |
| é˜…è¯»è®°å½• | âŒ | âœ… æ–°å¢ |
| ä¹¦ç±ç®¡ç† | âŒ | âœ… æ–°å¢ |
| é˜…è¯»è¿›åº¦ | âŒ | âœ… æ–°å¢ |
| æ•°æ®ä½ç½® | Dockerå· | æœ¬åœ°ç›®å½• |
| å¤‡ä»½æ–¹å¼ | å¤æ‚ | ç®€å• |

---

## ğŸ“Š æ•°æ®å­˜å‚¨å˜åŒ–

### v1.0ï¼ˆæ—§ç‰ˆï¼‰
```
æ•°æ®ä½ç½®ï¼š/var/lib/docker/volumes/eleven_study_mysql_data/
è®¿é—®æ–¹å¼ï¼šéœ€è¦Dockerå‘½ä»¤
å¤‡ä»½ï¼šdockerå‘½ä»¤å¯¼å‡º
```

### v2.0ï¼ˆæ–°ç‰ˆï¼‰
```
æ•°æ®ä½ç½®ï¼š/opt/eleven_study/data/mysql/
è®¿é—®æ–¹å¼ï¼šç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ
å¤‡ä»½ï¼šç›´æ¥å¤åˆ¶ç›®å½•
```

---

## ğŸ’¾ å¤‡ä»½å»ºè®®

### å‡çº§å‰å¤‡ä»½ï¼ˆå¿…é¡»ï¼‰

```bash
# SQLå¯¼å‡º
docker compose exec mysql mysqldump -uroot -på¯†ç  --all-databases > backup.sql
```

### å‡çº§åå¤‡ä»½ï¼ˆå»ºè®®ï¼‰

```bash
# æ–¹æ³•1ï¼šSQLå¯¼å‡º
docker compose exec mysql mysqldump -uroot -på¯†ç  literacy_db > backup.sql

# æ–¹æ³•2ï¼šç›®å½•å¤‡ä»½ï¼ˆéœ€åœæœï¼‰
docker compose stop mysql
tar -czf mysql_backup.tar.gz ./data/mysql/
docker compose start mysql

# æ–¹æ³•3ï¼šåœ¨çº¿å¤åˆ¶ï¼ˆå¯èƒ½ä¸ä¸€è‡´ï¼‰
cp -r ./data/mysql ./data/mysql_backup
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç£ç›˜ç©ºé—´

å‡çº§å‰ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ï¼ˆè‡³å°‘æ˜¯æ•°æ®åº“å¤§å°çš„2å€ï¼‰ï¼š

```bash
# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
docker compose exec mysql mysql -uroot -på¯†ç  -e "
SELECT 
    table_schema AS 'Database',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)'
FROM information_schema.tables 
WHERE table_schema = 'literacy_db'
GROUP BY table_schema;
"
```

### 2. MySQLå¯†ç 

å¦‚æœä½ ä¿®æ”¹è¿‡MySQLå¯†ç ï¼Œè®°å¾—è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export MYSQL_ROOT_PASSWORD=ä½ çš„å®é™…å¯†ç 
```

### 3. ç½‘ç»œè®¿é—®

ç¡®ä¿é˜²ç«å¢™å¼€æ”¾80ç«¯å£ï¼š

```bash
# CentOS 7
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --reload

# Ubuntu
sudo ufw allow 80/tcp
```

### 4. æ—§æ•°æ®å·

å‡çº§æˆåŠŸåï¼Œæ—§çš„Dockerå·è¿˜ä¿ç•™ç€ï¼Œç¡®è®¤æ— è¯¯åå¯åˆ é™¤ï¼š

```bash
# æŸ¥çœ‹Dockerå·
docker volume ls

# åˆ é™¤æ—§å·ï¼ˆç¡®è®¤æ•°æ®æ— è¯¯åï¼‰
docker volume rm eleven_study_mysql_data
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå‡çº§è„šæœ¬å¤±è´¥

**ç—‡çŠ¶**ï¼šè„šæœ¬æ‰§è¡Œåˆ°æŸä¸€æ­¥æŠ¥é”™

**è§£å†³**ï¼š
1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. æ‰‹åŠ¨æ‰§è¡Œå¤±è´¥çš„æ­¥éª¤
3. å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥å¯†ç 
4. å¦‚æœæ–‡ä»¶æƒé™é—®é¢˜ï¼Œä½¿ç”¨ `sudo`

### é—®é¢˜2ï¼šç½‘ç«™æ— æ³•è®¿é—®

**æ£€æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# 2. æŸ¥çœ‹æ—¥å¿—
docker compose logs frontend
docker compose logs backend
docker compose logs mysql

# 3. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 80

# 4. é‡å¯æœåŠ¡
docker compose restart
```

### é—®é¢˜3ï¼šæ•°æ®ä¸¢å¤±

**æ¢å¤æ•°æ®**ï¼š

```bash
# å¦‚æœæœ‰å¤‡ä»½æ–‡ä»¶
docker compose exec -T mysql mysql -uroot -på¯†ç  < backup.sql

# å¦‚æœæ—§Dockerå·è¿˜åœ¨
docker volume ls | grep mysql
# å¯ä»¥é‡æ–°è¿ç§»
```

### é—®é¢˜4ï¼šå‰ç«¯ä¾èµ–å®‰è£…å¤±è´¥

**è§£å†³**ï¼š

```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
docker run --rm \
    -v $(pwd)/frontend:/app \
    -w /app \
    node:18-alpine \
    sh -c "rm -rf node_modules package-lock.json && npm install --legacy-peer-deps"
```

### é—®é¢˜5ï¼šæƒé™é”™è¯¯

**ç—‡çŠ¶**ï¼š`Can't create/write to file`

**è§£å†³**ï¼š
```bash
# ä¿®å¤æ•°æ®ç›®å½•æƒé™
sudo chown -R 999:999 ./data/mysql
sudo chmod -R 750 ./data/mysql
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs mysql
docker compose logs backend
docker compose logs frontend

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
# æœåŠ¡çŠ¶æ€
docker compose ps

# è¯¦ç»†ä¿¡æ¯
docker compose ps -a

# èµ„æºä½¿ç”¨
docker stats
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart mysql

# å®Œå…¨é‡å»º
docker compose down
docker compose up -d --build
```

---

## ğŸ¯ å‡çº§åé…ç½®

### 1. ä¿®æ”¹MySQLå¯†ç ï¼ˆå¯é€‰ï¼‰

```bash
# è¿›å…¥MySQLå®¹å™¨
docker compose exec mysql mysql -uroot -ppassword

# ä¿®æ”¹å¯†ç 
ALTER USER 'root'@'%' IDENTIFIED BY 'æ–°å¯†ç ';
FLUSH PRIVILEGES;

# åŒæ—¶æ›´æ–° .env æ–‡ä»¶æˆ– docker-compose.yml
```

### 2. è®¾ç½®å®šæœŸå¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/eleven_study/daily-backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/eleven_study/backups"
DATE=$(date +%Y%m%d)
docker compose exec -T mysql mysqldump -uroot -ppassword literacy_db > $BACKUP_DIR/daily_$DATE.sql
gzip $BACKUP_DIR/daily_$DATE.sql
find $BACKUP_DIR -name "daily_*.sql.gz" -mtime +7 -delete
EOF

chmod +x /opt/eleven_study/daily-backup.sh

# æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
(crontab -l 2>/dev/null; echo "0 2 * * * /opt/eleven_study/daily-backup.sh") | crontab -
```

### 3. ç›‘æ§ç£ç›˜ç©ºé—´

```bash
# æŸ¥çœ‹æ•°æ®ç›®å½•å¤§å°
du -sh /opt/eleven_study/data/mysql

# è®¾ç½®ç£ç›˜ç©ºé—´ç›‘æ§
df -h | grep -E '/$|/opt'
```

---

## âœ¨ æ–°åŠŸèƒ½ä½¿ç”¨

### é˜…è¯»è®°å½•æ¨¡å—

1. **æ·»åŠ ä¹¦ç±**
   - ç‚¹å‡»"é˜…è¯»è®°å½•"èœå•
   - ç‚¹å‡»"æ·»åŠ æ–°ä¹¦"
   - å¡«å†™ä¹¦åã€ä½œè€…ç­‰ä¿¡æ¯

2. **å¼€å§‹é˜…è¯»**
   - åœ¨ä¹¦ç±åˆ—è¡¨æ‰¾åˆ°è¦è¯»çš„ä¹¦
   - ç‚¹å‡»"å¼€å§‹é˜…è¯»"

3. **æ›´æ–°è¿›åº¦**
   - ç‚¹å‡»ä¹¦ç±å¡ç‰‡
   - è¾“å…¥å½“å‰é¡µæ•°

4. **å®Œæˆé˜…è¯»**
   - ç‚¹å‡»"æ ‡è®°å®Œæˆ"

æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ï¼š`é˜…è¯»è®°å½•åŠŸèƒ½è¯´æ˜.md`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é˜…è¯»è®°å½•åŠŸèƒ½è¯´æ˜.md](./é˜…è¯»è®°å½•åŠŸèƒ½è¯´æ˜.md) - æ–°åŠŸèƒ½è¯¦ç»†è¯´æ˜
- [æ•°æ®æŒ‚è½½è¯´æ˜.md](./æ•°æ®æŒ‚è½½è¯´æ˜.md) - æ•°æ®ç®¡ç†è¯¦ç»†è¯´æ˜
- [README.md](./README.md) - é¡¹ç›®å®Œæ•´æ–‡æ¡£

---

## âœ… å‡çº§æ£€æŸ¥æ¸…å•

å®Œæˆå‡çº§åï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æ‰€æœ‰Dockerå®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] åŸæœ‰æ±‰å­—æ•°æ®å®Œæ•´
- [ ] åŸæœ‰å­¦ä¹ è®°å½•å®Œæ•´
- [ ] "é˜…è¯»è®°å½•"èœå•å¯è§
- [ ] å¯ä»¥æ·»åŠ æ–°ä¹¦ç±
- [ ] æ•°æ®å­˜å‚¨åœ¨ `./data/mysql` ç›®å½•
- [ ] å¤‡ä»½æ–‡ä»¶å·²ä¿å­˜

---

ç¥å‡çº§é¡ºåˆ©ï¼ğŸ‰ å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æˆ–æŒ‰ç…§æ•…éšœæ’æŸ¥æ­¥éª¤æ“ä½œã€‚

