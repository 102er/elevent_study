# ğŸ”„ æ›´æ–°è¯´æ˜ - æ·»åŠ é˜…è¯»è®°å½•åŠŸèƒ½

## â“ é‡æ–°éƒ¨ç½²ä¼šæ¸…ç©ºæ•°æ®å—ï¼Ÿ

### ç®€å•å›ç­”

**ä¸ä¼šï¼** åªè¦ä½ ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•ï¼Œæ‰€æœ‰ç°æœ‰æ•°æ®éƒ½ä¼šä¿ç•™ã€‚

---

## ğŸ“Š æ•°æ®å­˜å‚¨ä½ç½®

ä½ çš„æ•°æ®å­˜å‚¨åœ¨ **Docker æ•°æ®å·ï¼ˆVolumeï¼‰**ä¸­ï¼š

```bash
# æŸ¥çœ‹æ•°æ®å·
docker volume ls | grep literacy

# åº”è¯¥çœ‹åˆ°ï¼š
# eleven_study_mysql_data  â† ä½ çš„æ‰€æœ‰æ•°æ®éƒ½åœ¨è¿™é‡Œ
```

**åªè¦è¿™ä¸ªæ•°æ®å·ä¸åˆ é™¤ï¼Œæ•°æ®å°±æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼**

---

## âœ… å®‰å…¨æ›´æ–°æ–¹æ³•ï¼ˆæ¨èï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®‰å…¨æ›´æ–°è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

```bash
cd /opt/eleven_study

# ä¸€é”®å®‰å…¨æ›´æ–°ï¼ˆä¿ç•™æ‰€æœ‰æ•°æ®ï¼‰
./safe-update.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨å¤‡ä»½æ•°æ®ï¼ˆå¯é€‰ï¼‰
- âœ… é‡æ–°æ„å»ºé•œåƒ
- âœ… é‡å¯æœåŠ¡ï¼ˆä¸åˆ é™¤æ•°æ®ï¼‰
- âœ… æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆåªæ·»åŠ æ–°è¡¨ï¼‰
- âœ… ä¿ç•™æ‰€æœ‰ç°æœ‰æ•°æ®

---

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ›´æ–°ï¼ˆåˆ†æ­¥æ‰§è¡Œï¼‰

#### 1. å¤‡ä»½æ•°æ®ï¼ˆæ¨èä½†éå¿…éœ€ï¼‰

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backups

# å¤‡ä»½æ•°æ®åº“
docker compose exec mysql mysqldump -uroot -på¯†ç  literacy_db > backups/backup_$(date +%Y%m%d).sql
```

#### 2. é‡æ–°æ„å»ºé•œåƒ

```bash
docker compose build --no-cache
```

#### 3. é‡å¯æœåŠ¡ï¼ˆä¸åˆ é™¤æ•°æ®å·ï¼‰

```bash
# åœæ­¢å®¹å™¨ï¼ˆæ•°æ®å·ä¿ç•™ï¼‰
docker compose down

# å¯åŠ¨æ–°å®¹å™¨
docker compose up -d
```

#### 4. æ‰§è¡Œæ•°æ®åº“è¿ç§»

```bash
# ç­‰å¾…MySQLå¯åŠ¨
sleep 10

# æ‰§è¡Œè¿ç§»è„šæœ¬ï¼ˆæ·»åŠ æ–°è¡¨ï¼‰
docker compose exec -T mysql mysql -uroot -på¯†ç  < migrate-add-reading.sql
```

#### 5. éªŒè¯æ•°æ®

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps

# è®¿é—®åº”ç”¨
curl http://localhost/

# ç™»å½•æ•°æ®åº“æ£€æŸ¥
docker compose exec mysql mysql -uroot -på¯†ç  -e "USE literacy_db; SHOW TABLES;"
```

---

## âŒ å±é™©æ“ä½œï¼ˆä¼šåˆ é™¤æ•°æ®ï¼‰

### åƒä¸‡ä¸è¦è¿™æ ·åšï¼ˆé™¤éä½ ç¡®å®šè¦é‡ç½®ï¼‰

```bash
# âš ï¸ å±é™©ï¼ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®
docker compose down -v

# âš ï¸ å±é™©ï¼ä¼šåˆ é™¤æ•°æ®å·
docker volume rm eleven_study_mysql_data
```

**`-v` å‚æ•°ä¼šåˆ é™¤æ•°æ®å·ï¼Œå¯¼è‡´æ‰€æœ‰æ•°æ®ä¸¢å¤±ï¼**

---

## ğŸ” æ•°æ®æ£€æŸ¥å‘½ä»¤

### æŸ¥çœ‹ç°æœ‰æ•°æ®

```bash
# è¿›å…¥MySQLå®¹å™¨
docker compose exec mysql mysql -uroot -på¯†ç  literacy_db

# åœ¨MySQLä¸­æ‰§è¡Œï¼š
SHOW TABLES;                        # æŸ¥çœ‹æ‰€æœ‰è¡¨
SELECT COUNT(*) FROM words;         # æŸ¥çœ‹æ±‰å­—æ•°é‡
SELECT COUNT(*) FROM learning_records;  # æŸ¥çœ‹å­¦ä¹ è®°å½•æ•°é‡
SELECT stars FROM star_records;     # æŸ¥çœ‹æ˜Ÿæ˜Ÿæ•°é‡
SELECT COUNT(*) FROM books;         # æŸ¥çœ‹ä¹¦ç±æ•°é‡
```

---

## ğŸ“¦ æ›´æ–°åçš„æ•°æ®åº“ç»“æ„

### ç°æœ‰è¡¨ï¼ˆä¿ç•™ï¼‰
- âœ… `words` - æ±‰å­—è¡¨
- âœ… `learning_records` - å­¦ä¹ è®°å½•è¡¨
- âœ… `star_records` - æ˜Ÿæ˜Ÿè®°å½•è¡¨

### æ–°å¢è¡¨
- ğŸ†• `books` - ä¹¦ç±è¡¨
- ğŸ†• `reading_records` - é˜…è¯»è®°å½•è¡¨

**æ‰€æœ‰ç°æœ‰æ•°æ®å®Œå…¨ä¿ç•™ï¼Œåªæ˜¯æ·»åŠ äº†æ–°è¡¨ï¼**

---

## ğŸ¯ æ¨èæ›´æ–°æµç¨‹

### æœ€å®‰å…¨çš„æ›´æ–°æ­¥éª¤

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/eleven_study

# 2. æŸ¥çœ‹å½“å‰æœåŠ¡çŠ¶æ€
docker compose ps

# 3. æ‰§è¡Œå®‰å…¨æ›´æ–°è„šæœ¬
./safe-update.sh

# 4. ç­‰å¾…å®Œæˆï¼ˆçº¦2-3åˆ†é’Ÿï¼‰

# 5. è®¿é—®åº”ç”¨éªŒè¯
# æµè§ˆå™¨æ‰“å¼€: http://æœåŠ¡å™¨IP/
# æ£€æŸ¥ä¹‹å‰çš„å­¦ä¹ è®°å½•æ˜¯å¦è¿˜åœ¨
# ç‚¹å‡»"é˜…è¯»è®°å½•"æµ‹è¯•æ–°åŠŸèƒ½
```

---

## âš¡ å¿«é€Ÿé—®ç­”

### Q: æ›´æ–°ä¼šå½±å“ç°æœ‰çš„æ±‰å­—å’Œå­¦ä¹ è®°å½•å—ï¼Ÿ
**A:** ä¸ä¼šï¼æ‰€æœ‰ç°æœ‰æ•°æ®å®Œå…¨ä¿ç•™ã€‚

### Q: éœ€è¦é‡æ–°æ·»åŠ æ±‰å­—å—ï¼Ÿ
**A:** ä¸éœ€è¦ï¼ä¹‹å‰æ·»åŠ çš„æ±‰å­—éƒ½è¿˜åœ¨ã€‚

### Q: ä¹‹å‰çš„å­¦ä¹ è¿›åº¦ä¼šä¸¢å¤±å—ï¼Ÿ
**A:** ä¸ä¼šï¼å­¦ä¹ è®°å½•ã€æ˜Ÿæ˜Ÿæ•°é‡ã€å‘¨ç»Ÿè®¡éƒ½å®Œæ•´ä¿ç•™ã€‚

### Q: æ›´æ–°éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
**A:** å¤§çº¦2-3åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰ã€‚

### Q: æ›´æ–°å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
**A:** æ•°æ®åœ¨æ•°æ®å·ä¸­æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥é‡æ–°è¿è¡Œæ›´æ–°è„šæœ¬ã€‚

### Q: å¯ä»¥å›æ»šå—ï¼Ÿ
**A:** å¯ä»¥ï¼å¦‚æœåšäº†å¤‡ä»½ï¼Œå¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚

### Q: ä»€ä¹ˆæ—¶å€™æ•°æ®ä¼šä¸¢å¤±ï¼Ÿ
**A:** åªæœ‰ä½¿ç”¨ `docker compose down -v` å‘½ä»¤æ—¶æ‰ä¼šåˆ é™¤æ•°æ®ã€‚

---

## ğŸ’¾ æ•°æ®æ¢å¤ï¼ˆå¦‚æœéœ€è¦ï¼‰

### ä»å¤‡ä»½æ¢å¤

```bash
# æ¢å¤æ•°æ®åº“
docker compose exec -T mysql mysql -uroot -på¯†ç  literacy_db < backups/backup_20241028.sql

# é‡å¯æœåŠ¡
docker compose restart
```

---

## âœ¨ æ›´æ–°åçš„æ–°åŠŸèƒ½

æ›´æ–°å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š

### åŸæœ‰åŠŸèƒ½ï¼ˆå®Œå…¨ä¿ç•™ï¼‰
- âœ… è¯†å­—å­¦ä¹ 
- âœ… æ±‰å­—åº“ç®¡ç†
- âœ… å­¦ä¹ è¿›åº¦
- âœ… å‘¨ç»Ÿè®¡
- âœ… å¥–åŠ±ç³»ç»Ÿ

### æ–°å¢åŠŸèƒ½
- ğŸ†• é˜…è¯»è®°å½•ç®¡ç†
- ğŸ†• ä¹¦ç±ç®¡ç†
- ğŸ†• é˜…è¯»è¿›åº¦è¿½è¸ª
- ğŸ†• é˜…è¯»ç»Ÿè®¡

---

## ğŸ‰ æ€»ç»“

### è®°ä½è¿™ä¸‰ç‚¹ï¼š

1. **ä½¿ç”¨ `./safe-update.sh`** - æœ€å®‰å…¨ç®€å•
2. **ä¸è¦ä½¿ç”¨ `docker compose down -v`** - ä¼šåˆ é™¤æ•°æ®
3. **å®šæœŸå¤‡ä»½æ•°æ®åº“** - ä»¥é˜²ä¸‡ä¸€

**åªè¦æŒ‰ç…§æ¨èæ–¹æ³•ï¼Œä½ çš„æ•°æ®æ˜¯100%å®‰å…¨çš„ï¼** âœ…

---

ç°åœ¨å¯ä»¥æ”¾å¿ƒæ›´æ–°äº†ï¼ğŸš€

